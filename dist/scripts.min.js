let pokemonRepository = (function() {
  let e = [],
    t = 'https://pokeapi.co/api/v2/pokemon/?limit=150',
    n = document.createElement('img');
  function i() {
    n.classList.add('message-show');
  }
  function a() {
    n.classList.add('message-hide');
  }
  function l(t) {
    return e.push(t);
  }
  function o(e) {
    d(e).then(() => {
      let t = e.name,
        n = e.height,
        i = e.imageUrl,
        a = document.querySelector('.modal-container');
      function l() {
        a.classList.remove('is-visible');
      }
      !(function(e, t, n) {
        a.innerHTML = '';
        let i = document.createElement('div');
        i.classList.add('modal-dialog', 'modal-dialog-centered'),
          i.setAttribute('role', 'document');
        let o = document.createElement('div');
        o.classList.add('modal-content', 'modal');
        let d = document.createElement('div');
        d.classList.add('modal-header');
        let s = document.createElement('h5');
        (s.innerText = e),
          s.classList.add('modal-title'),
          s.setAttribute('id', 'exampleModalCenterTitle'),
          d.appendChild(s);
        let c = document.createElement('button');
        c.classList.add('close'),
          (c.innerText = 'close'),
          c.setAttribute('data-dismiss', 'modal'),
          c.setAttribute('aria-label', 'close'),
          c.addEventListener('click', () => {
            l();
          }),
          d.appendChild(c);
        let r = document.createElement('div');
        r.classList.add('modal-body');
        let m = document.createElement('p');
        (m.innerText = 'Height : ' + t), r.appendChild(m);
        let u = document.createElement('img');
        (u.src = n),
          u.classList.add('pokemon-image'),
          r.appendChild(u),
          o.appendChild(d),
          o.appendChild(r),
          i.appendChild(o),
          a.appendChild(i),
          a.classList.add('is-visible');
      })(t, n, i),
        window.addEventListener('keydown', e => {
          'Escape' === e.key && a.classList.contains('is-visible') && l();
        }),
        a.addEventListener('click', e => {
          e.target === a && l();
        });
    });
  }
  function d(e) {
    i();
    let t = e.detailsUrl;
    return fetch(t)
      .then(function(e) {
        return e.json();
      })
      .then(function(t) {
        a(),
          (e.imageUrl = t.sprites.front_default),
          (e.height = t.height),
          (e.types = t.types);
      })
      .catch(function(e) {
        a(), console.error('Error when validating item ', e);
      });
  }
  return (
    (n.src = 'img/loading.jpeg'),
    n.setAttribute('width', '80px'),
    n.setAttribute('height', '80px'),
    document.querySelector('.pokemon-list').appendChild(n),
    {
      getAll: function() {
        return e;
      },
      add: l,
      addListItem: function(e) {
        let t = document.querySelector('.pokemon-list'),
          n = document.createElement('li');
        n.classList.add('list-item', 'list-group-item', 'col');
        let i = document.createElement('button');
        (i.innerText = e.name),
          i.classList.add(
            'list-button',
            'btn',
            'btn-warning',
            'list-group-item-action'
          ),
          i.setAttribute('data-toggle', 'modal'),
          i.setAttribute('data-target', '#exampleModalCenter'),
          i.addEventListener('click', () => {
            o(e);
          }),
          t.appendChild(n),
          n.appendChild(i);
      },
      showDetails: o,
      loadList: function() {
        return (
          i(),
          fetch(t)
            .then(function(e) {
              return a(), e.json();
            })
            .then(function(e) {
              e.results.forEach(function(e) {
                l({ name: e.name, detailsUrl: e.url });
              });
            })
            .catch(function(e) {
              a(), console.error('Error when validating item', e);
            })
        );
      },
      loadDetails: d
    }
  );
})();
pokemonRepository.loadList().then(function() {
  pokemonRepository.getAll().forEach(function(e) {
    pokemonRepository.addListItem(e);
  });
});
